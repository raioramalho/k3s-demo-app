---
# ValidatingAdmissionPolicy para validar cluster
apiVersion: admissionregistration.k8s.io/v1alpha1
kind: ValidatingAdmissionPolicy
metadata:
  name: cluster-validation-policy
spec:
  failurePolicy: fail
  scope: Cluster
  rules:
  - apiGroups:
    - ""
    apiVersions:
    - v1
    operations:
    - CREATE
    - UPDATE
    resources:
    - namespaces
  validations:
  - expression: |
      has(object.metadata.labels) && 
      has(object.metadata.labels.cluster) && 
      object.metadata.labels.cluster == variables.clusterName
    message: "O namespace só pode ser aplicado no cluster definido no label 'cluster'. Cluster esperado: ${variables.clusterName}"
    reason: InvalidCluster

---
# ValidatingAdmissionPolicyBinding
apiVersion: admissionregistration.k8s.io/v1alpha1
kind: ValidatingAdmissionPolicyBinding
metadata:
  name: cluster-validation-binding
spec:
  policyName: cluster-validation-policy
  validationActions:
  - deny
  paramRef:
    name: cluster-params

---
# Parâmetros - substituir pelo nome do cluster
apiVersion: admissionregistration.k8s.io/v1alpha1
kind: ValidatingAdmissionPolicyParam
metadata:
  name: cluster-params
spec:
  clusterName: "edge-1"  # Mude para "edge-2" em Edge 2
